#!/usr/bin/env bash
#
# Run the webpack HMR devserver against a pre-compiled megadoc **runtime**
# config file.
#
# Usage:
#
#   ./bin/devserver /path/to/config.js
#
# To generate the needed config.js, run ./cli/index.js and look for that file
# in the outputDir.

[ -f "./package.json" ] && grep '"name": "megadoc"' ./package.json &> /dev/null || {
  echo "$0: Must be run from megadoc root.";
  exit 1
}

export NODE_ENV="development"
export VERBOSE=1
export CONFIG_FILE=$1
export NODE_PATH="packages/:$NODE_PATH"

shift

if [ -z "${CONFIG_FILE}" ]; then
  echo "Usage: $0 path/to/megadoc-config.js"
  exit 1
fi

if [ ! -d "./packages/megadoc-html-serializer/ui" ]; then
  echo "$1 must be run from megadoc's root."
  exit 1
fi

exec node ./packages/megadoc-html-live-server/lib/index.js $(pwd) $@